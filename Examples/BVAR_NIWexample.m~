% Set file paths
path_VARs = '/Users/patrickadams/Documents/FRBNY/VARs/';
addpath([path_VARs, filesep, 'General'])
addpath([path_VARs, filesep, 'BVAR_NIW'])

% Construct VAR
T = 100;
n = 2;
p = 1;
B_1 = [0.5, 0; 0.25, 0.5];
B = [zeros(2, 1), B_1]';
Sigma = eye(2);
Yinit = zeros(1, 2);

% Simulate VAR
Y = SimulateVAR(T, B, Sigma, Yinit);

% Set NIW prior
BPrior = zeros(3, 2);
OmegaPrior = 0.8 * eye(3);
PsiPrior = eye(2);
dfPrior = n + 2;

% Estimate BVAR
BVAR_NIW = EstimateBVAR_NIW(Y, BPrior, OmegaPrior, PsiPrior, dfPrior);

% Forecast H periods ahead
H = 20;
num_draws = 5000;
Z = ForecastBVAR_NIW(BVAR_NIW, Y((end - p + 1):end, :), H, num_draws);
forecasts = mean(Z, 3);
prctile025 = prctile(Z, 2.5, 3);
prctile975 = prctile(Z, 97.5, 3);
xconf = (T + 1):(T + H); xconf = [xconf, fliplr(xconf)];

colors = get(gca, 'colororder');
gray = [0.5 0.5 0.5];

for i = 1:n
    subplot(n, 1, i)
    hold on;
    
    yconf = [prctile025(:, i)', fliplr(prctile975(:, i)')];
    fill(xconf, yconf, gray);
    
    plot([Y(:, i); NaN(H, 1)], 'color', colors(i, :))
    plot([NaN(T - 1, 1); Y(T, i); forecasts(:, i)], '--', 'color', colors(i, :))
end